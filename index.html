<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ÙˆÛŒØ¯ÛŒÙˆ + QR (Ø¨Ø§ ÙØ§Ù„Ø¨Ú© ØªØ¶Ù…ÛŒÙ†ÛŒ)</title>

  <!-- Ø§Ø³ØªØ§ÛŒÙ„ Ø³Ø§Ø¯Ù‡ -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡Ù” QR (Ø§Ú¯Ø± Ù‡Ø± Ø¯Ù„ÛŒÙ„ÛŒ Ù„ÙˆØ¯ Ù†Ø´Ù‡ØŒ Ù¾Ø§ÛŒÛŒÙ† ÙØ§Ù„Ø¨Ú© Ø¯Ø§Ø±ÛŒÙ…) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"
          integrity="sha512-CNgI+PvfSaH0YzZp0yDW8s0kL9sZf1R8Q9vuuqUj5hT1o4d7q9gH9B2v3F9zj7+zVQhVYt8NwS1f+7x7YkBv3g=="
          crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <style>
    @media print { #controls{display:none!important} #grid{grid-template-columns:repeat(3,minmax(0,1fr))} }
    .mono{font-family:ui-monospace,Menlo,Consolas,monospace}
  </style>
</head>
<body class="bg-neutral-50 text-neutral-900">
  <header class="sticky top-0 z-10 bg-white/80 backdrop-blur border-b">
    <div id="controls" class="max-w-5xl mx-auto px-4 py-4 flex items-center gap-3">
      <div class="font-bold text-lg">ğŸ¬ ÙˆÛŒØ¯ÛŒÙˆ + QR</div>
      <div class="ml-auto">
        <button id="print" class="border rounded px-3 py-2 text-sm hover:bg-neutral-100">Ù¾Ø±ÛŒÙ†Øª QR</button>
      </div>
    </div>
  </header>

  <main class="max-w-5xl mx-auto px-4 py-8">
    <!-- Ù„Ø§Ú¯ Ø¨Ø±Ø§ÛŒ Ø¹ÛŒØ¨â€ŒÛŒØ§Ø¨ÛŒ -->
    <pre id="log" class="mono text-xs bg-white border rounded p-3 mb-4 whitespace-pre-wrap"></pre>

    <!-- Ú©Ø§Ø±Øª -->
    <div id="card" class="overflow-hidden rounded-2xl shadow-sm bg-white border flex flex-col"></div>
  </main>

  <footer class="border-t bg-white/70">
    <div class="max-w-5xl mx-auto px-4 py-6 text-xs text-neutral-500 flex items-center justify-between">
      <div>Â© <span id="year"></span></div>
      <button id="copy" class="px-2 py-1 rounded hover:bg-neutral-100">Ú©Ù¾ÛŒ Ø¢Ø¯Ø±Ø³ ØµÙØ­Ù‡</button>
    </div>
  </footer>

  <script>
  // â€”â€”â€” ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø´Ù…Ø§ â€”â€”â€”
  const VIDEO_URL = "https://navidrahmani94.github.io/music-qr-portfolio/assets/videos/logo%20M.mp4";
  const QR_SIZE = 148;

  // â€”â€”â€” Ú©Ù…Ú©â€ŒÙ‡Ø§ â€”â€”â€”
  const logEl = document.getElementById("log");
  function log(...args){ logEl.textContent += args.join(" ") + "\n"; }
  function makeQRWithLib(container, text) {
    try {
      if (typeof QRCode === "function") {
        new QRCode(container, { text, width: QR_SIZE, height: QR_SIZE });
        // Ø§Ú¯Ø± Ø®Ø±ÙˆØ¬ÛŒ <canvas> Ø¨ÙˆØ¯ Ø¨Ù‡ <img> ØªØ¨Ø¯ÛŒÙ„Ø´ Ú©Ù†ÛŒÙ… ØªØ§ Ø¯Ú©Ù…Ù‡Ù” Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´ÛŒÙ…
        const img = container.querySelector("img");
        if (!img) {
          const canvas = container.querySelector("canvas");
          if (canvas) {
            const i = new Image();
            i.src = canvas.toDataURL("image/png");
            i.width = QR_SIZE; i.height = QR_SIZE;
            i.className = "rounded border";
            container.innerHTML = "";
            container.appendChild(i);
          }
        } else {
          img.width = QR_SIZE; img.height = QR_SIZE;
          img.className = "rounded border";
        }
        return true;
      }
    } catch(e){ log("QR lib error:", e.message); }
    return false;
  }
  function makeQRFallbackIMG(container, text) {
    const url = "https://api.qrserver.com/v1/create-qr-code/?size="
                + QR_SIZE + "x" + QR_SIZE + "&data="
                + encodeURIComponent(text);
    const img = new Image();
    img.src = url;
    img.width = QR_SIZE; img.height = QR_SIZE;
    img.alt = "QR";
    img.className = "rounded border";
    container.innerHTML = "";
    container.appendChild(img);
    return img;
  }

  // â€”â€”â€” UI Ø§Ø¨ØªØ¯Ø§ÛŒÛŒ â€”â€”â€”
  document.getElementById("year").textContent = new Date().getFullYear();
  document.getElementById("print").onclick = () => window.print();
  document.getElementById("copy").onclick  = () => navigator.clipboard.writeText(location.href);

  log("PAGE_URL =", location.href);
  log("VIDEO_URL =", VIDEO_URL);

  const card = document.getElementById("card");

  // â€”â€”â€” ÙˆÛŒØ¯ÛŒÙˆ â€”â€”â€”
  const media = document.createElement("div");
  const vid = document.createElement("video");
  vid.controls = true;
  vid.preload = "metadata";
  vid.className = "w-full h-60 object-contain bg-black";
  const src = document.createElement("source");
  src.src = VIDEO_URL; src.type = "video/mp4";
  vid.appendChild(src);
  media.appendChild(vid);
  card.appendChild(media);

  // Ø§Ú¯Ø± Ù¾Ø®Ø´ Ø®Ø·Ø§ Ø¯Ø§Ø´ØªØŒ Ù¾ÛŒØ§Ù… Ø¨Ø¯Ù‡
  vid.addEventListener("error", ()=>{
    const err = vid.error, map = {1:"ABORTED",2:"NETWORK",3:"DECODE",4:"SRC_NOT_SUPPORTED"};
    const code = err?.code || 0;
    log("VIDEO_ERROR code=" + code + " (" + (map[code]||"UNKNOWN") + ")");
    const warn = document.createElement("div");
    warn.className = "p-3 mt-2 text-sm rounded bg-red-50 border text-red-700";
    warn.textContent = "Ù¾Ø®Ø´ ÙˆÛŒØ¯ÛŒÙˆ Ø®Ø·Ø§ Ø¯Ø§Ø¯: code=" + code + " (" + (map[code]||"UNKNOWN") + ") â€” Ø§Ú¯Ø± 404 Ø§Ø³Øª Ù…Ø³ÛŒØ±/Ù†Ø§Ù… ÙØ§ÛŒÙ„ Ø±Ø§ Ú†Ú© Ú©Ù†Ø› Ø§Ú¯Ø± DECODE Ø§Ø³Øª ÙØ§ÛŒÙ„ Ø±Ø§ Ø¨Ù‡ H.264/AAC ØªØ¨Ø¯ÛŒÙ„ Ú©Ù†.";
    media.appendChild(warn);
  });

  // â€”â€”â€” Ø¨Ø¯Ù†Ù‡ + QR â€”â€”â€”
  const body = document.createElement("div");
  body.className = "p-4";
  body.innerHTML = `
    <div class="font-semibold text-base">ÙˆÛŒØ¯ÛŒÙˆ</div>
    <div class="mt-2 text-xs text-neutral-600 break-all">
      Ù„ÛŒÙ†Ú© Ù…Ø³ØªÙ‚ÛŒÙ…: <a class="underline text-blue-600" href="${VIDEO_URL}" target="_blank" rel="noreferrer">${VIDEO_URL}</a>
    </div>
  `;
  const row = document.createElement("div");
  row.className = "mt-4 flex items-center gap-3";

  const qrBox = document.createElement("div");
  qrBox.id = "qrBox";
  row.appendChild(qrBox);

  const actions = document.createElement("div");
  actions.className = "flex flex-col gap-2";
  const open = document.createElement("a");
  open.className = "px-3 py-2 rounded bg-black text-white text-sm hover:opacity-90 inline-block";
  open.href = VIDEO_URL; open.target = "_blank"; open.rel = "noreferrer"; open.textContent = "Open";
  const copyBtn = document.createElement("button");
  copyBtn.className = "px-3 py-2 rounded border text-sm hover:bg-neutral-100";
  copyBtn.textContent = "Copy Link";
  copyBtn.onclick = ()=> navigator.clipboard.writeText(VIDEO_URL);
  const dl = document.createElement("a");
  dl.className = "px-3 py-2 rounded border text-sm hover:bg-neutral-100 inline-block";
  dl.textContent = "Download QR";
  dl.id = "dlQR";
  actions.append(open, copyBtn, dl);
  row.appendChild(actions);

  body.appendChild(row);
  card.appendChild(body);

  // â€”â€”â€” Ø³Ø§Ø®Øª QR Ø¨Ø§ Ø¯Ùˆ Ø­Ø§Ù„Øª: Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ ÛŒØ§ ÙØ§Ù„Ø¨Ú© â€”â€”â€”
  let qrImgElement = null;
  const ok = makeQRWithLib(qrBox, VIDEO_URL);
  if (ok) {
    log("QR: Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯ Ø¨Ø§ qrcodejs");
    qrImgElement = qrBox.querySelector("img") || qrBox.querySelector("canvas");
    // Ø§Ú¯Ø± <canvas> Ø¨ÙˆØ¯ØŒ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ù…Ø³ØªÙ‚ÛŒÙ… ØªØµÙˆÛŒØ± Ù†Ø¯Ø§Ø±ÛŒÙ…Ø› Ø¯Ø± makeQRWithLib Ø¨Ù‡ <img> ØªØ¨Ø¯ÛŒÙ„ Ú©Ø±Ø¯ÛŒÙ….
  } else {
    log("QR: ÙØ§Ù„Ø¨Ú© Ø¢Ù†Ù„Ø§ÛŒÙ† (img) ÙØ¹Ø§Ù„ Ø´Ø¯");
    qrImgElement = makeQRFallbackIMG(qrBox, VIDEO_URL);
  }

  // Ù„ÛŒÙ†Ú© Ø¯Ø§Ù†Ù„ÙˆØ¯ QR (Ø§Ú¯Ø± dataURL Ø¯Ø§Ø±ÛŒÙ… Ø§Ø² Ù‡Ù…Ø§Ù†ØŒ ÙˆÚ¯Ø±Ù†Ù‡ Ø§Ø² src)
  const dlLink = document.getElementById("dlQR");
  if (qrImgElement.tagName.toLowerCase() === "img" && qrImgElement.src.startsWith("data:")) {
    dlLink.href = qrImgElement.src;
  } else {
    // Ø§Ú¯Ø± Ø¹Ú©Ø³ Ø§Ø² Ø³Ø±ÙˆÛŒØ³ Ø¢Ù†Ù„Ø§ÛŒÙ† Ø§Ø³ØªØŒ Ù‡Ù…Ø§Ù† src Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ù…ÛŒâ€ŒÚ¯Ø°Ø§Ø±ÛŒÙ…
    dlLink.href = qrImgElement.src || VIDEO_URL;
  }
  dlLink.download = "video-qr.png";
  </script>

  <script>document.getElementById('year').textContent = new Date().getFullYear();</script>
</body>
</html>
